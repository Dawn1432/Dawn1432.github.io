---
layout: post
title: jvm杂谈
date: 2018-10-24
tags: experience_note(job_interview)
---
### 说明
JVM为java开发者屏蔽了很多系统相关的工作，使得开发者可以专心把工作重心放到自己的业务逻辑上，这也是当初我选择java原因之一。但现如今感觉熟不熟悉java的面试官似乎都知道问问gc的垃圾回收机制，所以作为一个java开发程序员是否熟悉JVM的工作机制也就成为了首要的判断标准。<br>
JVM/Java Virtual Machine/Java虚拟机是一个抽象的计算机结构，java代码根据JVM的特性进行编写，JVM将java指令翻译成对应的平台底层指令并执行，也因此保证了JAVA的平台无关性。<br>
JVM其实有很多种，其中比较主流的一种就是Java HotSpot，而通常情况下我们提起JVM也就说的是它。<br>

本文由作者阅读该系列文章后编写：<br>
[importnew](http://www.importnew.com/)翻译：[Java GC系列](http://www.importnew.com/13504.html)；<br>
译者：[ImportNew.com - 好好先生](http://www.importnew.com/author/liruifeng)、[ImportNew.com - 伍翀](http://www.importnew.com/author/cool1014)、[ImportNew.com - lomoxy](http://www.importnew.com/author/xiaoyuan)<br>
[javapaper](https://javapapers.com/)原文：[Java Garbage Collection Introduction](http://javapapers.com/java/java-garbage-collection-introduction/)
### GC/Garbage Collection/垃圾回收机制
这个机制涉及到2个JVM的结构，Heap Memory/堆内存和Garbage Collector/垃圾收集器。
## <strong>堆内存</strong>
在运行时，java的实例被存储在堆内存中，当实例不再被引用时，就会被GC移出堆内存，并回收其对应的内存空间，这就是垃圾回收。<br>
首先要看看堆的结构，堆由新生代，老年代(tenured)和永久代构成。【java8的新特性已经移除了永久代】
<br>新生代又可以从前到后分为,Eden->S0 Survivor空间->S1 Survivor空间。
## <strong>启动GC</strong>
gc的启动由JVM决定，你可以调用system.gc()和runtime.gc()，但是并不能保证能启动gc。那.gc()调用的意义呢？
## <strong>GC过程</strong>
- 所有实例在创建时会通过存储到堆内存的Eden中。
- 在一次minor gc（年轻代gc）的周期中,满足条件的对象会Eden->S0。
- 在一次minor gc（年轻代gc）的周期中,满足条件的对象会S0->S1。
- 在一次minor gc（年轻代gc）的周期中,满足条件的对象会S1->tenured。
- 在一次major gc（老年代gc）的周期中,满足条件的对象会继续留在tenured。<br>
ask:那不满足条件的呢？
- 从堆内存中移除，并回收其空间。<br>
不同实例的内存回收使得内存空间碎片化，为了内存的快速分配，垃圾收集器会对其进行碎片整理工作。

## <strong>GC条件</strong>
- 所有实例都没有活动的线程访问。
- 没有没其他实例访问的循环引用实例。
- 引用类型：
	- 强引用，不回收
	- 软引用，可能回收
	- 弱应用，回收
	- 虚引用，回收

## <strong>Garbage Collector种类</strong>
- 串行垃圾回收器（Serial Garbage Collector）
	- 参数：-XX:+UseSerialGC，单线程工作，冻结所有应用程序线程。
- 并行垃圾回收器（Parallel Garbage Collector）[default]
	- 参数：-XX:+UseParallelGC，多线程工作，冻结所有应用程序线程。
- 并发标记扫描垃圾回收器（CMS Garbage Collector）
	- 参数：-XX:+UseParNewGC，特性大致与并行垃圾回收器相同，在工作时会使用更多CPU；在一定条件下冻结所有应用程序线程：
		- 当待回收对象在tenured区域；
		- 在垃圾回收时，堆内存数据被并发的改变。
- G1垃圾回收器（G1 Garbage Collector）
	- 参数：-XX:+useG1GC，将堆内存分块并发执行回收，并对回收剩余的堆内存空间进行压缩，一般适用于堆内存很大的情况。G1会优先选择垃圾最多的区域。